<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fechas de Cobro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white text-center">
                        <h1 class="mb-0" id="pageTitle">üóìÔ∏è Fechas de Cobro</h1>
                        <p class="mb-0">Cronograma de pagos de sueldos</p>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="yearSelector" class="form-label">Seleccionar A√±o:</label>
                                <select class="form-select" id="yearSelector">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th scope="col">Mes</th>
                                        <th scope="col">Fecha de Pago</th>
                                        <th scope="col">Tipo</th>
                                    </tr>
                                </thead>
                                <tbody id="payrollTable">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4">
                            <div class="alert alert-info" role="alert">
                                <h6 class="alert-heading">üìã Reglas de Pago:</h6>
                                <ul class="mb-0">
                                    <li><strong>Adelanto:</strong> Si el primer d√≠a h√°bil del mes siguiente es lunes, fin de semana o feriado, se paga el √∫ltimo d√≠a h√°bil del mes actual.</li>
                                    <li><strong>Fecha normal:</strong> Si el primer d√≠a h√°bil del mes siguiente es martes a viernes (no feriado), se paga ese mismo d√≠a.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="payroll-dates.js"></script>
    <script>
        function getPayType(year, month) {
            const nextMonth = month === 11 ? 0 : month + 1;
            const nextYear = month === 11 ? year + 1 : year;
            const firstBusinessDayNextMonth = getFirstBusinessDayOfMonth(nextYear, nextMonth);

            if (isWeekendOrHoliday(firstBusinessDayNextMonth) || isMonday(firstBusinessDayNextMonth)) {
                return { type: 'Adelanto', class: 'text-warning' };
            } else {
                return { type: 'Normal', class: 'text-success' };
            }
        }

        // Populate the year selector
        function populateYearSelector() {
            const yearSelector = document.getElementById('yearSelector');
            const availableYears = getAvailableYears();
            const currentYear = new Date().getFullYear();

            // Clear existing options
            yearSelector.innerHTML = '';

            // Add year options
            availableYears.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelector.appendChild(option);
            });

            // Add event listener for year change
            yearSelector.addEventListener('change', function() {
                populatePayrollTable(parseInt(this.value));
            });
        }

        // Populate the table
        function populatePayrollTable(selectedYear) {
            const year = selectedYear || new Date().getFullYear();
            const tbody = document.getElementById('payrollTable');
            const months = [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
            ];

            // Update page title with selected year
            document.getElementById('pageTitle').textContent = `üóìÔ∏è Fechas de Cobro ${year}`;

            // Clear existing rows
            tbody.innerHTML = '';

            for (let month = 0; month < 12; month++) {
                const payDate = getPayDate(year, month);
                const payType = getPayType(year, month);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${months[month]}</strong></td>
                    <td>${formatDate(payDate)}</td>
                    <td><span class="${payType.class}">${payType.type}</span></td>
                `;
                tbody.appendChild(row);
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            populateYearSelector();
            populatePayrollTable();
        });
    </script>
</body>
</html>
